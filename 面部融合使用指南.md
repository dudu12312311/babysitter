# ğŸ¼ å®å®é¢éƒ¨èåˆç”Ÿæˆå™¨ - å®Œæ•´ä½¿ç”¨æŒ‡å—

## ğŸ¯ åŠŸèƒ½è¯´æ˜

**è¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„åŠŸèƒ½ï¼š**
- âœ… ä¸Šä¼  1-2 å¼ çˆ¶æ¯ç…§ç‰‡
- âœ… AI åˆ†æçˆ¶æ¯é¢éƒ¨ç‰¹å¾
- âœ… ç”Ÿæˆé¢„æµ‹çš„å®å®ç…§ç‰‡
- âœ… æ”¯æŒä¸åŒå¹´é¾„é˜¶æ®µï¼ˆæ–°ç”Ÿå„¿ã€6ä¸ªæœˆã€1å²ã€2å²ï¼‰
- âœ… ä¸€æ¬¡ç”Ÿæˆ 1-4 å¼ å˜ä½“
- âœ… ç¡®ä¿ç”Ÿæˆçº¯æ­£ä¸­å›½å®å®ç‰¹å¾

## ğŸ“¦ æ–°åˆ›å»ºçš„æ–‡ä»¶

1. **baby_face_fusion.py** - é¢éƒ¨èåˆæ ¸å¿ƒæ¨¡å—
2. **baby_face_fusion_api.py** - Flask API ç«¯ç‚¹ï¼ˆæ”¯æŒæ–‡ä»¶ä¸Šä¼ ï¼‰
3. **main_face_fusion.py** - ç‹¬ç«‹çš„ Flask åº”ç”¨
4. **test_face_fusion.py** - æµ‹è¯•è„šæœ¬
5. **install_face_fusion.bat** - ä¸€é”®å®‰è£…ä¾èµ–
6. **é¢éƒ¨èåˆä½¿ç”¨æŒ‡å—.md** - æœ¬æ–‡ä»¶

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ3æ­¥ï¼‰

### æ­¥éª¤ 1: å®‰è£…ä¾èµ–

**æ–¹æ³• A: ä½¿ç”¨ä¸€é”®å®‰è£…è„šæœ¬ï¼ˆæ¨èï¼‰**

åŒå‡»è¿è¡Œï¼š
```
install_face_fusion.bat
```

**æ–¹æ³• B: æ‰‹åŠ¨å®‰è£…**

```bash
pip install fal-client Flask Werkzeug Pillow
```

### æ­¥éª¤ 2: è®¾ç½® API å¯†é’¥

```bash
set FAL_KEY=ä½ çš„fal.aiå¯†é’¥
```

**å¦‚ä½•è·å– API å¯†é’¥ï¼š**
1. è®¿é—® https://fal.ai/
2. æ³¨å†Œ/ç™»å½•è´¦å·
3. è¿›å…¥ Settings â†’ API Keys
4. åˆ›å»ºæ–°çš„ API å¯†é’¥
5. å¤åˆ¶å¯†é’¥ï¼ˆç±»ä¼¼ï¼š`fal_xxx...`ï¼‰

### æ­¥éª¤ 3: è¿è¡Œæµ‹è¯•

```bash
python test_face_fusion.py
```

**é¢„æœŸè¾“å‡ºï¼š**
```
ğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ª
å®å®é¢éƒ¨èåˆåŠŸèƒ½æµ‹è¯•
ğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ªğŸ§ª

============================================================
æµ‹è¯•ç»“æœæ‘˜è¦
============================================================
æ¨¡å—å¯¼å…¥              âœ… é€šè¿‡
ä¾èµ–å®‰è£…              âœ… é€šè¿‡
API å¯†é’¥é…ç½®          âœ… é€šè¿‡
ä¸Šä¼ æ–‡ä»¶å¤¹            âœ… é€šè¿‡
é¢éƒ¨èåˆç”Ÿæˆå™¨        âœ… é€šè¿‡
Flask åº”ç”¨            âœ… é€šè¿‡

============================================================
æ€»è®¡: 6 é€šè¿‡, 0 å¤±è´¥
============================================================

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼é¢éƒ¨èåˆåŠŸèƒ½å·²å°±ç»ªã€‚
```

## ğŸ¨ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1: ä½¿ç”¨ Web ç•Œé¢ï¼ˆæ¨èï¼‰

#### 1.1 å¯åŠ¨åº”ç”¨

```bash
python main_face_fusion.py
```

#### 1.2 è®¿é—®ç½‘é¡µ

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š
```
http://localhost:5000
```

#### 1.3 ä¸Šä¼ ç…§ç‰‡

1. ç‚¹å‡» "å¼€å§‹ç”Ÿæˆå®å®ç…§ç‰‡" æŒ‰é’®
2. é€‰æ‹©çˆ¶æ¯1çš„ç…§ç‰‡ï¼ˆå¿…éœ€ï¼‰
3. é€‰æ‹©çˆ¶æ¯2çš„ç…§ç‰‡ï¼ˆå¯é€‰ï¼‰
4. é€‰æ‹©å®å®å¹´é¾„ï¼ˆæ–°ç”Ÿå„¿ã€6ä¸ªæœˆã€1å²ã€2å²ï¼‰
5. é€‰æ‹©ç”Ÿæˆæ•°é‡ï¼ˆ1-4å¼ ï¼‰
6. ç‚¹å‡» "ç”Ÿæˆå®å®ç…§ç‰‡"
7. ç­‰å¾… 10-20 ç§’
8. æŸ¥çœ‹ç”Ÿæˆçš„å®å®ç…§ç‰‡

### æ–¹æ³• 2: ä½¿ç”¨ Python ä»£ç 

```python
from baby_face_fusion import BabyFaceFusion

# åˆ›å»ºç”Ÿæˆå™¨
generator = BabyFaceFusion()

# ç”Ÿæˆå®å®ç…§ç‰‡
result = generator.generate_baby_from_parents_fal(
    parent1_image="path/to/parent1.jpg",
    parent2_image="path/to/parent2.jpg",  # å¯é€‰
    baby_age="newborn",  # newborn, 6months, 1year, 2years
    num_variations=4
)

if result["success"]:
    print("ç”ŸæˆæˆåŠŸï¼")
    for i, url in enumerate(result["images"], 1):
        print(f"ç…§ç‰‡ {i}: {url}")
else:
    print(f"ç”Ÿæˆå¤±è´¥: {result['message']}")
```

### æ–¹æ³• 3: ä½¿ç”¨ API

#### 3.1 ä¸Šä¼ æ–‡ä»¶ç”Ÿæˆ

```bash
curl -X POST http://localhost:5000/api/baby-fusion/upload-and-generate \
  -F "parent1=@parent1.jpg" \
  -F "parent2=@parent2.jpg" \
  -F "baby_age=newborn" \
  -F "num_variations=4"
```

#### 3.2 ä» URL ç”Ÿæˆ

```bash
curl -X POST http://localhost:5000/api/baby-fusion/generate-from-urls \
  -H "Content-Type: application/json" \
  -d "{\"parent1_url\": \"https://...\", \"baby_age\": \"newborn\"}"
```

## ğŸ“Š å‚æ•°è¯´æ˜

### baby_age (å®å®å¹´é¾„)

| å€¼ | è¯´æ˜ | ç‰¹å¾ |
|---|---|---|
| newborn | æ–°ç”Ÿå„¿ (0-3ä¸ªæœˆ) | æŸ”è½¯çš®è‚¤ï¼Œé—­çœ¼æˆ–ç¡è§‰ |
| 6months | 6ä¸ªæœˆå©´å„¿ | å¼€å§‹åç«‹ï¼Œå¥½å¥‡è¡¨æƒ… |
| 1year | 1å²å¹¼å„¿ | æ´»æ³¼å¥½åŠ¨ï¼Œæ¸…æ™°äº”å®˜ |
| 2years | 2å²å„¿ç«¥ | è¡¨æƒ…ä¸°å¯Œï¼Œä¸ªæ€§æ˜æ˜¾ |

### num_variations (ç”Ÿæˆæ•°é‡)

- **1**: ç”Ÿæˆ1å¼ ç…§ç‰‡
- **2**: ç”Ÿæˆ2å¼ ç…§ç‰‡
- **4**: ç”Ÿæˆ4å¼ ç…§ç‰‡ï¼ˆæ¨èï¼‰

## ğŸ¯ ç…§ç‰‡è¦æ±‚

### çˆ¶æ¯ç…§ç‰‡å»ºè®®

âœ… **æ¨èï¼š**
- æ­£é¢æ¸…æ™°ç…§ç‰‡
- å…‰çº¿å……è¶³
- é¢éƒ¨å®Œæ•´å¯è§
- è¡¨æƒ…è‡ªç„¶
- é«˜åˆ†è¾¨ç‡ï¼ˆè‡³å°‘ 512x512ï¼‰

âŒ **é¿å…ï¼š**
- ä¾§è„¸æˆ–åŠè„¸
- æˆ´å¢¨é•œæˆ–å£ç½©
- å…‰çº¿å¤ªæš—
- æ¨¡ç³Šä¸æ¸…
- è¿‡åº¦ç¾é¢œ

### æ”¯æŒçš„æ–‡ä»¶æ ¼å¼

- PNG (.png)
- JPEG (.jpg, .jpeg)
- WebP (.webp)

### æ–‡ä»¶å¤§å°é™åˆ¶

- æœ€å¤§ 16MB

## ğŸ”§ é«˜çº§é…ç½®

### ä¿®æ”¹æç¤ºè¯

å¦‚æœæƒ³è°ƒæ•´ç”Ÿæˆçš„å®å®ç‰¹å¾ï¼Œç¼–è¾‘ `baby_face_fusion.py` ä¸­çš„æç¤ºè¯ï¼š

```python
prompt = f"""
{age_prompt}, (pure Chinese baby:1.5), adorable baby portrait,
(single eyelid:1.2), (black straight hair:1.3), (dark brown eyes:1.3),
(flat nose bridge:1.1), round face, chubby cheeks,
professional baby photography, studio lighting, high quality, 8k
"""
```

**è°ƒæ•´æƒé‡ï¼š**
- å¢åŠ æƒé‡ï¼š`(pure Chinese baby:1.8)` - æ›´å¼ºè°ƒä¸­å›½ç‰¹å¾
- å‡å°‘æƒé‡ï¼š`(pure Chinese baby:1.2)` - å‡å¼±å¼ºè°ƒ

### é›†æˆåˆ°ç°æœ‰åº”ç”¨

åœ¨ä½ çš„ `main.py` ä¸­æ·»åŠ ï¼š

```python
from baby_face_fusion_api import baby_fusion_bp

app.register_blueprint(baby_fusion_bp)
```

## ğŸ“± API ç«¯ç‚¹

### 1. å¥åº·æ£€æŸ¥

```
GET /api/baby-fusion/health
```

**å“åº”ï¼š**
```json
{
  "status": "healthy",
  "fal_available": true,
  "fal_key_configured": true
}
```

### 2. ä¸Šä¼ å¹¶ç”Ÿæˆ

```
POST /api/baby-fusion/upload-and-generate
```

**è¡¨å•æ•°æ®ï¼š**
- `parent1`: æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
- `parent2`: æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
- `baby_age`: å­—ç¬¦ä¸²ï¼ˆnewborn, 6months, 1year, 2yearsï¼‰
- `num_variations`: æ•´æ•°ï¼ˆ1-4ï¼‰

**å“åº”ï¼š**
```json
{
  "success": true,
  "images": [
    "https://fal.media/files/...",
    "https://fal.media/files/...",
    "https://fal.media/files/...",
    "https://fal.media/files/..."
  ],
  "metadata": {
    "baby_age": "newborn",
    "num_variations": 4
  }
}
```

### 3. ä» URL ç”Ÿæˆ

```
POST /api/baby-fusion/generate-from-urls
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "parent1_url": "https://...",
  "parent2_url": "https://...",
  "baby_age": "newborn",
  "num_variations": 4
}
```

### 4. æµ‹è¯•ä¸Šä¼ è¡¨å•

```
GET /api/baby-fusion/test-upload
```

è¿”å›ä¸€ä¸ªå®Œæ•´çš„ HTML ä¸Šä¼ è¡¨å•é¡µé¢ã€‚

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: å®‰è£…ä¾èµ–å¤±è´¥

**è§£å†³ï¼š**
```bash
# ä½¿ç”¨å›½å†…é•œåƒ
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple fal-client Flask Werkzeug Pillow
```

### Q2: ä¸Šä¼ æ–‡ä»¶å¤±è´¥

**æ£€æŸ¥ï¼š**
1. æ–‡ä»¶å¤§å°æ˜¯å¦è¶…è¿‡ 16MB
2. æ–‡ä»¶æ ¼å¼æ˜¯å¦æ”¯æŒï¼ˆpng, jpg, jpeg, webpï¼‰
3. æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®

### Q3: ç”Ÿæˆçš„ç…§ç‰‡ä¸åƒçˆ¶æ¯

**åŸå› ï¼š** å½“å‰ AI æ¨¡å‹ä¸»è¦åŸºäºæç¤ºè¯ç”Ÿæˆï¼Œé¢éƒ¨èåˆåŠŸèƒ½æœ‰é™

**æ”¹è¿›æ–¹æ¡ˆï¼š**
1. ä½¿ç”¨æ›´é«˜çº§çš„é¢éƒ¨èåˆæ¨¡å‹ï¼ˆå¦‚ Replicate çš„ä¸“ä¸šæ¨¡å‹ï¼‰
2. è°ƒæ•´æç¤ºè¯æƒé‡
3. æä¾›æ›´æ¸…æ™°çš„çˆ¶æ¯ç…§ç‰‡

### Q4: ç”Ÿæˆé€Ÿåº¦æ…¢

**åŸå› ï¼š** æ­£å¸¸ç°è±¡ï¼ŒAI ç”Ÿæˆéœ€è¦æ—¶é—´

**ä¼˜åŒ–ï¼š**
- å‡å°‘ç”Ÿæˆæ•°é‡
- ä½¿ç”¨æ›´å¿«çš„æ¨¡å‹
- å®ç°å¼‚æ­¥å¤„ç†

### Q5: API è¿”å› 401 é”™è¯¯

**è§£å†³ï¼š**
1. æ£€æŸ¥ FAL_KEY æ˜¯å¦æ­£ç¡®
2. è®¿é—® fal.ai ç¡®è®¤å¯†é’¥æœ‰æ•ˆ
3. é‡æ–°è®¾ç½®ç¯å¢ƒå˜é‡

## ğŸ’° æˆæœ¬ä¼°ç®—

### fal.ai å®šä»·

- **Flux æ¨¡å‹**: çº¦ $0.003-0.01 / å¼ 
- **ç”Ÿæˆ4å¼ **: çº¦ $0.012-0.04
- **1024x1024 åˆ†è¾¨ç‡**

### ä½¿ç”¨å»ºè®®

- å¼€å‘æµ‹è¯•æ—¶ä½¿ç”¨å°‘é‡ç”Ÿæˆ
- ç”Ÿäº§ç¯å¢ƒç¼“å­˜ç»“æœ
- ä¸ºç”¨æˆ·è®¾ç½®ç”Ÿæˆæ¬¡æ•°é™åˆ¶

## ğŸ“ æŠ€æœ¯è¯´æ˜

### å·¥ä½œåŸç†

1. **ä¸Šä¼ ç…§ç‰‡** â†’ ä¿å­˜åˆ° `uploads/parents/` æ–‡ä»¶å¤¹
2. **åˆ†æç‰¹å¾** â†’ AI æ¨¡å‹åˆ†æçˆ¶æ¯é¢éƒ¨ç‰¹å¾
3. **ç”Ÿæˆæç¤ºè¯** â†’ ç»“åˆå¹´é¾„å’Œä¸­å›½ç‰¹å¾ç”Ÿæˆæç¤ºè¯
4. **AI ç”Ÿæˆ** â†’ fal.ai Flux æ¨¡å‹ç”Ÿæˆå®å®ç…§ç‰‡
5. **è¿”å›ç»“æœ** â†’ è¿”å›å›¾ç‰‡ URL

### é™åˆ¶è¯´æ˜

âš ï¸ **å½“å‰ç‰ˆæœ¬é™åˆ¶ï¼š**
- é¢éƒ¨èåˆåŠŸèƒ½æœ‰é™ï¼ˆä¸»è¦åŸºäºæç¤ºè¯ï¼‰
- ç”Ÿæˆç»“æœå¯èƒ½ä¸å®Œå…¨åƒçˆ¶æ¯
- éœ€è¦é«˜è´¨é‡çš„çˆ¶æ¯ç…§ç‰‡
- ç”Ÿæˆæ—¶é—´è¾ƒé•¿ï¼ˆ10-20ç§’ï¼‰

ğŸ’¡ **æœªæ¥æ”¹è¿›ï¼š**
- é›†æˆä¸“ä¸šé¢éƒ¨èåˆæ¨¡å‹
- æ”¯æŒæ›´ç²¾ç¡®çš„ç‰¹å¾æå–
- å®ç°å®æ—¶é¢„è§ˆ
- æ·»åŠ ç…§ç‰‡ç¼–è¾‘åŠŸèƒ½

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `baby_face_fusion.py` - æ ¸å¿ƒæ¨¡å—æºç 
- `baby_face_fusion_api.py` - API ç«¯ç‚¹æºç 
- `main_face_fusion.py` - åº”ç”¨å…¥å£
- `test_face_fusion.py` - æµ‹è¯•è„šæœ¬

## âœ… æ£€æŸ¥æ¸…å•

å®Œæˆä»¥ä¸‹æ­¥éª¤åï¼Œä½ å°±å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼š

- [ ] è¿è¡Œ `install_face_fusion.bat` å®‰è£…ä¾èµ–
- [ ] è®¾ç½® `FAL_KEY` ç¯å¢ƒå˜é‡
- [ ] è¿è¡Œ `python test_face_fusion.py` æµ‹è¯•
- [ ] è¿è¡Œ `python main_face_fusion.py` å¯åŠ¨åº”ç”¨
- [ ] è®¿é—® `http://localhost:5000`
- [ ] ä¸Šä¼ çˆ¶æ¯ç…§ç‰‡æµ‹è¯•ç”Ÿæˆ

## ğŸ‰ å®Œæˆï¼

æ­å–œï¼ä½ ç°åœ¨å¯ä»¥ä¸Šä¼ çˆ¶æ¯ç…§ç‰‡ï¼Œç”Ÿæˆé¢„æµ‹çš„å®å®ç…§ç‰‡äº†ã€‚

**ä¸‹ä¸€æ­¥ï¼š**
1. å‡†å¤‡çˆ¶æ¯ç…§ç‰‡ï¼ˆæ­£é¢æ¸…æ™°ç…§ç‰‡ï¼‰
2. å¯åŠ¨åº”ç”¨å¹¶ä¸Šä¼ ç…§ç‰‡
3. æŸ¥çœ‹ç”Ÿæˆçš„å®å®ç…§ç‰‡
4. æ ¹æ®éœ€è¦è°ƒæ•´å‚æ•°

**éœ€è¦å¸®åŠ©ï¼Ÿ**
- è¿è¡Œæµ‹è¯•è„šæœ¬è¯Šæ–­é—®é¢˜
- æŸ¥çœ‹å¸¸è§é—®é¢˜éƒ¨åˆ†
- æ£€æŸ¥ API å¯†é’¥é…ç½®

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸš€
