# å®å®ç…§ç‰‡ç”ŸæˆåŠŸèƒ½é›†æˆæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ å°†ä¸­å›½å®å®ç…§ç‰‡ç”ŸæˆåŠŸèƒ½é›†æˆåˆ°è‚²å„¿æ¨¡æ‹Ÿå™¨ä¸­ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

- âœ… ç”Ÿæˆçº¯æ­£ä¸­å›½å®å®ç‰¹å¾çš„ç…§ç‰‡
- âœ… é¿å…æ··è¡€ã€è¥¿æ–¹ç‰¹å¾
- âœ… æ”¯æŒä¸åŒå¹´é¾„é˜¶æ®µï¼ˆ0-36ä¸ªæœˆï¼‰
- âœ… æ”¯æŒä¸åŒè¡¨æƒ…å’Œåœºæ™¯
- âœ… ä¸æ¸¸æˆçŠ¶æ€è”åŠ¨

## ğŸ“¦ æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶

1. **chinese_baby_prompts.py** - æç¤ºè¯é…ç½®ç³»ç»Ÿ
   - åŒ…å«æ‰€æœ‰å¹´é¾„é˜¶æ®µçš„æç¤ºè¯
   - æ­£é¢æç¤ºè¯å¼ºåŒ–ä¸­å›½ç‰¹å¾
   - è´Ÿé¢æç¤ºè¯æ’é™¤è¥¿æ–¹ç‰¹å¾

2. **baby_photo_integration.py** - ç…§ç‰‡ç”Ÿæˆé›†æˆæ¨¡å—
   - `BabyPhotoGenerator` ç±»å°è£…ç”Ÿæˆé€»è¾‘
   - æ”¯æŒæ ¹æ®æœˆé¾„è‡ªåŠ¨é€‰æ‹©å¹´é¾„é˜¶æ®µ
   - æ”¯æŒæ ¹æ®æ¸¸æˆçŠ¶æ€ç”Ÿæˆç…§ç‰‡

3. **baby_photo_api.py** - Flask API ç«¯ç‚¹
   - `/api/baby-photo/generate` - ç”Ÿæˆç…§ç‰‡
   - `/api/baby-photo/generate-from-game` - æ ¹æ®æ¸¸æˆçŠ¶æ€ç”Ÿæˆ
   - `/api/baby-photo/preview-prompt` - é¢„è§ˆæç¤ºè¯
   - `/api/baby-photo/health` - å¥åº·æ£€æŸ¥

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: å®‰è£…ä¾èµ–

```bash
pip install fal-client
```

### æ­¥éª¤ 2: è®¾ç½® API å¯†é’¥

åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®ä½ çš„ fal.ai API å¯†é’¥ï¼š

**Windows (CMD):**
```cmd
set FAL_KEY=your_api_key_here
```

**Windows (PowerShell):**
```powershell
$env:FAL_KEY="your_api_key_here"
```

**Linux/Mac:**
```bash
export FAL_KEY=your_api_key_here
```

æˆ–è€…åœ¨ä»£ç ä¸­ç›´æ¥è®¾ç½®ï¼š
```python
generator = BabyPhotoGenerator(api_key="your_api_key_here")
```

### æ­¥éª¤ 3: é›†æˆåˆ° main.py

åœ¨ä½ çš„ `main.py` ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```python
from flask import Flask
from baby_photo_api import baby_photo_bp

app = Flask(__name__)

# æ³¨å†Œå®å®ç…§ç‰‡ç”Ÿæˆ Blueprint
app.register_blueprint(baby_photo_bp)

# ... å…¶ä»–ä»£ç  ...
```

### æ­¥éª¤ 4: æµ‹è¯• API

å¯åŠ¨åº”ç”¨åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æµ‹è¯•ï¼š

**æµ‹è¯•å¥åº·æ£€æŸ¥:**
```bash
curl http://localhost:5000/api/baby-photo/health
```

**ç”Ÿæˆç…§ç‰‡:**
```bash
curl -X POST http://localhost:5000/api/baby-photo/generate \
  -H "Content-Type: application/json" \
  -d "{\"age_months\": 6, \"gender\": \"boy\", \"expression\": \"happy\", \"scene\": \"studio\"}"
```

**é¢„è§ˆæç¤ºè¯:**
```bash
curl -X POST http://localhost:5000/api/baby-photo/preview-prompt \
  -H "Content-Type: application/json" \
  -d "{\"age_months\": 6, \"gender\": \"boy\", \"expression\": \"happy\", \"scene\": \"studio\"}"
```

## ğŸ’» ä»£ç ç¤ºä¾‹

### ç¤ºä¾‹ 1: åœ¨æ¸¸æˆä¸­ç”Ÿæˆå®å®ç…§ç‰‡

```python
from baby_photo_integration import BabyPhotoGenerator

# åˆ›å»ºç”Ÿæˆå™¨
generator = BabyPhotoGenerator()

# ç”Ÿæˆæ–°ç”Ÿå„¿ç…§ç‰‡
result = generator.generate_baby_photo(
    age_months=1,
    gender="boy",
    expression="sleeping",
    scene="studio"
)

if result["success"]:
    print(f"ç…§ç‰‡URL: {result['image_url']}")
else:
    print(f"ç”Ÿæˆå¤±è´¥: {result['message']}")
```

### ç¤ºä¾‹ 2: æ ¹æ®æ¸¸æˆçŠ¶æ€ç”Ÿæˆç…§ç‰‡

```python
from baby_photo_integration import BabyPhotoGenerator
from hardcore_parenting_game import GameState

# åˆ›å»ºç”Ÿæˆå™¨
generator = BabyPhotoGenerator()

# å‡è®¾ä½ æœ‰ä¸€ä¸ªæ¸¸æˆçŠ¶æ€
game_state = GameState(
    baby_age_months=6,
    happiness=80,
    health=90,
    is_sleeping=False
)

# æ ¹æ®æ¸¸æˆçŠ¶æ€ç”Ÿæˆç…§ç‰‡
result = generator.generate_for_game_state(game_state)

if result["success"]:
    print(f"ç…§ç‰‡URL: {result['image_url']}")
    print(f"è¡¨æƒ…: {result['metadata']['expression']}")
```

### ç¤ºä¾‹ 3: åœ¨ Flask è·¯ç”±ä¸­ä½¿ç”¨

```python
from flask import Flask, jsonify
from baby_photo_integration import BabyPhotoGenerator

app = Flask(__name__)
generator = BabyPhotoGenerator()

@app.route('/game/baby-photo')
def get_baby_photo():
    # å‡è®¾ä»æ¸¸æˆçŠ¶æ€è·å–ä¿¡æ¯
    result = generator.generate_baby_photo(
        age_months=6,
        gender="girl",
        expression="happy",
        scene="home"
    )
    return jsonify(result)
```

## ğŸ¨ å‚æ•°è¯´æ˜

### age_months (æœˆé¾„)
- **ç±»å‹**: int
- **èŒƒå›´**: 0-36
- **è¯´æ˜**: å®å®çš„æœˆé¾„ï¼Œä¼šè‡ªåŠ¨æ˜ å°„åˆ°å¯¹åº”å¹´é¾„é˜¶æ®µ
  - 0-3æœˆ: æ–°ç”Ÿå„¿
  - 3-12æœˆ: å©´å„¿
  - 1-2å²: å¹¼å„¿
  - 2-3å²: å­¦é¾„å‰

### gender (æ€§åˆ«)
- **ç±»å‹**: str æˆ– None
- **é€‰é¡¹**: "boy", "girl", None
- **è¯´æ˜**: å®å®æ€§åˆ«ï¼ŒNone è¡¨ç¤ºéšæœº

### expression (è¡¨æƒ…)
- **ç±»å‹**: str
- **é€‰é¡¹**: 
  - "happy" - å¼€å¿ƒ
  - "sleeping" - ç¡è§‰
  - "curious" - å¥½å¥‡
  - "crying" - å“­æ³£
  - "neutral" - ä¸­æ€§

### scene (åœºæ™¯)
- **ç±»å‹**: str
- **é€‰é¡¹**:
  - "studio" - å·¥ä½œå®¤
  - "home" - å®¶åº­ç¯å¢ƒ
  - "outdoor" - æˆ·å¤–

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰æç¤ºè¯

å¦‚æœéœ€è¦ä¿®æ”¹æç¤ºè¯ï¼Œç¼–è¾‘ `chinese_baby_prompts.py`:

```python
# ä¿®æ”¹æ­£é¢æç¤ºè¯
POSITIVE_PROMPT_BASE = """
(pure Chinese baby:1.5), (single eyelid:1.2), 
(black straight hair:1.3), (dark brown eyes:1.3),
ä½ çš„è‡ªå®šä¹‰å†…å®¹...
"""

# ä¿®æ”¹è´Ÿé¢æç¤ºè¯
NEGATIVE_PROMPT_BASE = """
mixed race, caucasian, western features,
ä½ è¦æ’é™¤çš„å†…å®¹...
"""
```

### è°ƒæ•´ç”Ÿæˆå‚æ•°

åœ¨ `chinese_baby_prompts.py` çš„ `get_fal_ai_config` å‡½æ•°ä¸­ä¿®æ”¹ï¼š

```python
return {
    "prompt": prompts["positive"],
    "negative_prompt": prompts["negative"],
    "image_size": "square_hd",  # ä¿®æ”¹å›¾ç‰‡å°ºå¯¸
    "num_inference_steps": 4,    # ä¿®æ”¹æ¨ç†æ­¥æ•°
    "guidance_scale": 3.5        # ä¿®æ”¹å¼•å¯¼å¼ºåº¦
}
```

## ğŸ“Š API å“åº”æ ¼å¼

### æˆåŠŸå“åº”

```json
{
  "success": true,
  "image_url": "https://fal.media/files/...",
  "metadata": {
    "age_months": 6,
    "age_stage": "infant_3_12",
    "gender": "boy",
    "expression": "happy",
    "scene": "studio",
    "prompt": "å®Œæ•´çš„æç¤ºè¯..."
  }
}
```

### å¤±è´¥å“åº”

```json
{
  "success": false,
  "error": "é”™è¯¯ç±»å‹",
  "message": "è¯¦ç»†é”™è¯¯ä¿¡æ¯"
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **API å¯†é’¥å®‰å…¨**
   - ä¸è¦å°† API å¯†é’¥ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
   - ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶
   - ä¸è¦å°†å¯†é’¥æäº¤åˆ° Git

2. **æˆæœ¬æ§åˆ¶**
   - fal.ai æŒ‰ç”Ÿæˆæ¬¡æ•°æ”¶è´¹
   - å»ºè®®ç¼“å­˜ç”Ÿæˆçš„ç…§ç‰‡
   - åœ¨å¼€å‘æ—¶ä½¿ç”¨é¢„è§ˆæç¤ºè¯åŠŸèƒ½

3. **ç”Ÿæˆæ—¶é—´**
   - æ¯æ¬¡ç”Ÿæˆéœ€è¦ 5-15 ç§’
   - å»ºè®®å¼‚æ­¥å¤„ç†
   - æ˜¾ç¤ºåŠ è½½åŠ¨ç”»æå‡ç”¨æˆ·ä½“éªŒ

4. **å›¾ç‰‡å­˜å‚¨**
   - fal.ai è¿”å›çš„ URL æœ‰æ—¶æ•ˆæ€§
   - å»ºè®®ä¸‹è½½å¹¶ä¿å­˜åˆ°è‡ªå·±çš„æœåŠ¡å™¨
   - æˆ–ä½¿ç”¨äº‘å­˜å‚¨æœåŠ¡

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: ImportError: No module named 'fal_client'

**è§£å†³æ–¹æ¡ˆ:**
```bash
pip install fal-client
```

### é—®é¢˜ 2: ç…§ç‰‡ç”ŸæˆåŠŸèƒ½ä¸å¯ç”¨

**æ£€æŸ¥æ¸…å•:**
1. ç¡®è®¤å·²å®‰è£… fal-client
2. ç¡®è®¤å·²è®¾ç½® FAL_KEY ç¯å¢ƒå˜é‡
3. æ£€æŸ¥ API å¯†é’¥æ˜¯å¦æœ‰æ•ˆ
4. è®¿é—® `/api/baby-photo/health` æŸ¥çœ‹çŠ¶æ€

### é—®é¢˜ 3: ç”Ÿæˆçš„ç…§ç‰‡ä¸æ˜¯ä¸­å›½å®å®

**è§£å†³æ–¹æ¡ˆ:**
1. æ£€æŸ¥ `chinese_baby_prompts.py` ä¸­çš„æç¤ºè¯
2. ç¡®è®¤æ­£é¢æç¤ºè¯åŒ…å« `(pure Chinese baby:1.5)`
3. ç¡®è®¤è´Ÿé¢æç¤ºè¯åŒ…å«æ’é™¤é¡¹
4. å¢åŠ æƒé‡å€¼ï¼Œå¦‚ `(pure Chinese baby:1.8)`

### é—®é¢˜ 4: API è¿”å›é”™è¯¯

**å¸¸è§é”™è¯¯:**
- `401 Unauthorized` - API å¯†é’¥æ— æ•ˆ
- `429 Too Many Requests` - è¯·æ±‚è¿‡äºé¢‘ç¹
- `500 Internal Server Error` - fal.ai æœåŠ¡é—®é¢˜

## ğŸ“š æ›´å¤šèµ„æº

- [fal.ai å®˜æ–¹æ–‡æ¡£](https://fal.ai/docs)
- [Flux æ¨¡å‹æ–‡æ¡£](https://fal.ai/models/fal-ai/flux)
- [æç¤ºè¯å·¥ç¨‹æŒ‡å—](https://github.com/dair-ai/Prompt-Engineering-Guide)

## ğŸ¤ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. `ä¸­å›½å®å®ç…§ç‰‡ç”ŸæˆæŒ‡å—.md` - æç¤ºè¯è¯¦ç»†è¯´æ˜
2. `fal_ai_integration.py` - å®Œæ•´é›†æˆç¤ºä¾‹
3. æœ¬æ–‡ä»¶çš„æ•…éšœæ’æŸ¥éƒ¨åˆ†

---

**ç¥ä½ æˆåŠŸé›†æˆå®å®ç…§ç‰‡ç”ŸæˆåŠŸèƒ½ï¼** ğŸ‰
